<mvc:View
    controllerName="com.sap.agentbuddy.controller.SocketView"
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    displayBlock="true"
    height="100%">
    
    <Page title="Agent Buddy - SAP Service Cloud Integration" showHeader="true">
        <content>
            
            <!-- Icon Tab Bar for different sections -->
            <IconTabBar id="idIconTabBarStretchContent" class="sapUiResponsiveContentPadding">
                <items>
                    <IconTabFilter icon="sap-icon://message" text="Messages" key="messages">
                        <content>
                            <!-- Messages Content -->
                            <Panel headerText="Activity Log" class="sapUiResponsiveMargin">
                                <content>
                                    <List items="{activity>/activities}" showNoData="true">
                                        <StandardListItem
                                            title="{activity>message}"
                                            description="{activity>timestamp}"
                                            type="Active" />
                                    </List>
                                </content>
                            </Panel>
                        </content>
                    </IconTabFilter>
                    
                    <IconTabFilter icon="sap-icon://phone" text="Calls" key="calls" visible="false">
                        <content>
                            <!-- Calls Content -->
                            <Panel headerText="Call Control" class="sapUiResponsiveMargin">
                                <content>
                                    <VBox alignItems="Center" justifyContent="Center">
                                        <Text text="Incoming Call: {incomingCall>/phoneNumber}" 
                                              class="sapUiTinyMarginBottom"
                                              visible="{= ${incomingCall>/phoneNumber} !== ''}" />
                                        
                                        <HBox justifyContent="Center" class="sapUiTinyMargin">
                                            <Button text="Accept Call" 
                                                    icon="sap-icon://accept" 
                                                    type="Accept" 
                                                    press="onAcceptCall"
                                                    visible="{= ${callStatus>/status} === 'ringing'}"
                                                    class="sapUiTinyMarginEnd" />
                                            
                                            <Button text="Decline Call" 
                                                    icon="sap-icon://decline" 
                                                    type="Reject" 
                                                    press="onDeclineCall"
                                                    visible="{= ${callStatus>/status} === 'ringing'}"
                                                    class="sapUiTinyMarginStart" />
                                        </HBox>
                                        
                                        <Text text="Status: {callStatus>/status}" 
                                              class="sapUiTinyMarginTop" />
                                        <Text text="Last Action: {callStatus>/lastAction}" 
                                              class="sapUiTinyMarginTop" />
                                    </VBox>
                                </content>
                            </Panel>
                        </content>
                    </IconTabFilter>
                    
                    <IconTabFilter icon="sap-icon://settings" text="Configuration" key="config">
                        <content>
                            <!-- Configuration Content -->
                            <Panel headerText="SAP Integration Settings" class="sapUiResponsiveMargin">
                                <content>
                                    <l:Grid defaultSpan="XL3 L3 M6 S12" class="sapUiSmallMarginTop">
                                        <l:content>
                                            <Label text="Socket.io URL:" labelFor="socketUrl" />
                                            <Input id="socketUrl" 
                                                   value="{= ${/socketUrl} || 'https://agent-buddy-socketio.onrender.com'}"
                                                   placeholder="Socket.io server URL" />
                                            
                                            <Label text="SAP C4C Endpoint:" labelFor="sapEndpoint" />
                                            <Input id="sapEndpoint" 
                                                   value="{= ${/sapEndpoint} || 'https://my1000354.de1.test.crm.cloud.sap/api/calls'}"
                                                   placeholder="SAP C4C API endpoint" />
                                            
                                            <Label text="SAP Username:" labelFor="sapUsername" />
                                            <Input id="sapUsername" 
                                                   value="{= ${/sapUsername} || 'LEEMREIA'}"
                                                   placeholder="SAP username" />
                                            
                                            <Label text="SAP Password:" labelFor="sapPassword" />
                                            <Input id="sapPassword" 
                                                   type="Password"
                                                   placeholder="SAP password" />
                                        </l:content>
                                    </l:Grid>
                                    
                                    <HBox justifyContent="Center" class="sapUiTinyMarginTop">
                                        <Button text="Test Connection" 
                                                icon="sap-icon://test" 
                                                press="onTestConnection"
                                                class="sapUiTinyMarginEnd" />
                                        
                                        <Button text="Simulate Call" 
                                                icon="sap-icon://phone" 
                                                press="onSimulateCall"
                                                class="sapUiTinyMarginStart" />
                                    </HBox>
                                </content>
                            </Panel>
                        </content>
                    </IconTabFilter>
                </items>
            </IconTabBar>
            
            <!-- Connection Status Panel -->
            <Panel headerText="Connection Status" class="sapUiResponsiveMargin">
                <content>
                    <l:Grid defaultSpan="XL4 L4 M6 S12" class="sapUiSmallMarginTop">
                        <l:content>
                            <VBox>
                                <Label text="Socket.io Status:" />
                                <Text text="{callStatus>/connectionStatus}" 
                                      class="{= ${callStatus>/connectionStatus} === 'connected' ? 'sapUiTinyMarginTop sapThemePositiveText' : 'sapUiTinyMarginTop sapThemeNegativeText'}" />
                            </VBox>
                            
                            <VBox>
                                <Label text="Call Status:" />
                                <Text text="{callStatus>/status}" 
                                      class="sapUiTinyMarginTop" />
                            </VBox>
                            
                            <VBox>
                                <Label text="Agent ID:" />
                                <Text text="{callStatus>/agentId}" 
                                      class="sapUiTinyMarginTop" />
                            </VBox>
                        </l:content>
                    </l:Grid>
                </content>
            </Panel>
            
            <!-- SAP Integration Panel -->
            <Panel headerText="SAP C4C Integration" class="sapUiResponsiveMargin">
                <content>
                    <l:Grid defaultSpan="XL6 L6 M6 S12" class="sapUiSmallMarginTop">
                        <l:content>
                            <VBox>
                                <Label text="Last SAP Action:" />
                                <Text text="{callStatus>/lastAction}" 
                                      class="sapUiTinyMarginTop" />
                            </VBox>
                            
                            <VBox>
                                <Label text="SAP Endpoint:" />
                                <Text text="{= ${/sapEndpoint} || 'Not configured'}" 
                                      class="sapUiTinyMarginTop" />
                            </VBox>
                        </l:content>
                    </l:Grid>
                </content>
            </Panel>
            
        </content>
        
        <footer>
            <Toolbar>
                <ToolbarSpacer />
                <Button text="Refresh" 
                        icon="sap-icon://refresh" 
                        press="onRefresh" />
            </Toolbar>
        </footer>
        
    </Page>
    
</mvc:View> 